# Name:    PyHouse-ansible/playbooks/development-pis.yaml
# Author:  D. Brian Kimmel
# Created: 2017-11-20
# Updated: 2018-04-24















---

- name: Development-Pis.yaml - First.
  hosts:                all
  strategy:             linear
  become:               yes
  become_method:        sudo
  gather_facts:     yes



  pre_tasks:

    - name: DevelopmentPis-PreTask-00- Starting, Display some vars...
      debug:
        msg:
          - "User: {{pyh_admin_user}}"
          - "Dist: {{ansible_os_family}}"
          - "Host: {{pyh_hostname}}"
          - "Role: {{pyh_roles}}"
      tags:
        - always

    - name: DevelopmentPis-PreTask-01 - Fail if Ansible is ancient
      fail:
        msg:        "We need Ansible >= 2.4. Please update your installed ansible"
      when:         ansible_version.major < 2 or ( ansible_version.major >= 2 and ansible_version.minor < 4 )
      tags:
        - always

    - name: DevelopmentPis-PreTask-02 - Dynamic Include vars from local-configure.yaml if found
      include_vars: "{{ item }}"
      with_first_found:
        - files:
            - "local-configure.yaml"
            - "null.yaml"
          paths:
            - "../defaults/"
      tags:
        - always


# ========================================================================
# ==== pyh_roles dispatch

  roles:

    - role: roles/install-basic-system
      tags: always

    - role: roles/install-mqtt
      when: pyh_roles.find("mqtt") != -1
      tags: always

    - role: roles/install-octoprint
      when: pyh_roles.find("octoprint") != -1
      tags: always

    - role: roles/install-pyhouse
      when: pyh_roles.find("pyhouse") != -1
      tags: always

    - role: roles/install-pandora
      when: pyh_roles.find("pandora") != -1
      tags: always

    - role: roles/install-node-red
      when: pyh_roles.find("node-red") != -1
      tags: always

### END DBK
