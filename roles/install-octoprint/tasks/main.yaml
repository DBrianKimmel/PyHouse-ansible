# Name:    PyHouse-ansible/roles/install-octoprint/tasks/main.yaml
# Author:  D. Brian Kimmel
# Created: 2018-06-27
# Updated: 2018-06-30
#
# This role will install  * * * O C T O P R I N T * * *  on a raspberry pi computer.
#
# Be sure to edit group_vars/octoprint.yaml











---

- name: Task-00 - main info for the role.
  debug:
    msg:
      - "Install Octoprint     * * * O C T O P R I N T * * *"
      - " "
      - "Dist:          {{ ansible_os_family }}"
      - "Lsb:           {{ ansible_lsb }}"


- name: Task-01 - fetch the pyhouse group vars
  include_vars:         octoprint.yaml

- name: Task-02 - Add User "octo"
  include_tasks:         "../roles/common/tasks/add-user.yaml p_user={{ pyh_user_name }} p_comment={{ pyh_user_comment}} p_groups={{ pyh_user_groups }}"

- name: Task-03 - Install apt packages
  include_tasks:         ../roles/install-octoprint/tasks/install-extra-packages.yaml 

#mkdir OctoPrint && cd OctoPrint
- name: Task-04 - Create OctoPrint dir
  ignore_errors:        yes
  become_user:          root
  become:               yes
  file:
    name:               "/home/{{ pyh_user_name }}/{{ pyh_octoprint_dir }}"
    state:              directory
    owner:              "{{ pyh_user_name }}"
    group:              "{{ pyh_user_name }}"
    mode:               0755

- name: Task-05 - Create virtualenv
  sudo:                 true
  sudo_user:            "{{ pyh_user_name }}"
  command:              "virtualenv /home/{{ pyh_user_name }}/{{ pyh_octoprint_dir}}"

- name: Task-06 - Activate virtualenv
  sudo:                 yes
  sudo_user:            "{{ pyh_user_name }}"
  # command:              "/home/{{ pyh_user_name }}/{{ pyh_octoprint_dir }}/bin/source /home/{{ pyh_user_name }}/{{ pyh_octoprint_dir }}/bin/activate"
  pip: 
    requirements:       /my_app/requirements.txt
    virtualenv:         /user/home/venvs/myenv
    virtualenv_python:  python2.7


#virtualenv venv
#source venv/bin/activate
#pip install pip --upgrade
#pip install https://get.octoprint.org/latest

### END DBK
