# Name:    PyHouse-ansible/roles/hostname/tasks/main.yaml
# Author:  D. Brian Kimmel
# Created: 2017-10-14
# Updated: 2017-10-14
#
# Set up the computer's hostname
#
# Tags:
#   hostname
#
# Vars:
#   hostname_avahi
#   inventory_hostname
#   inventory_hostname_short
#

---

- name: task-01 | Ensure dbus installed
  apt:
    name:   dbus
    state:  installed
  tags: hostname

- name: task-02 | Update the hostname (pt. 1) - hostname cmd
  hostname:
    name: "{{pyh_hostname}}"
  tags: hostname

- name: task-03 | Update the hostname (pt. 2) - (/etc/hostname)
  copy:
    content:    "{{pyh_hostname}}{{'\n'}}"
    dest:       /etc/hostname
    owner:      root
    group:      root
    mode:       0644
  tags: hostname

- name: task-04 | Update the IPv4 hostname (pt. 3) - (/etc/hosts)
  lineinfile:
    dest:       /etc/hosts
    regexp:     "^127.0.1.1"
    line: "127.0.1.1{{'\t'}}{{pyh_hostname}}{% if pyh_domain != '' %}{{'\t'}}{{pyh_hostname}}.{{pyh.domain}}{% endif %}{{'\t'}}localhost"
    state:      present
  tags: hostname

- name: task-05 | Update the IPv6 hostname (pt. 3) - (/etc/hosts)
  lineinfile:
    dest:       /etc/hosts
    regexp:     "^::1"
    line: "::1{{'\t\t'}}{{pyh_hostname}}{% if pyh_domain != '' %}{{'\t'}}{{pyh_hostname}}.{{pyh.domain}}{% endif %}{{'\t'}}localhost ip6-localhost ip6-loopback"
    state:      present
  tags: hostname

#- name: task-06 | Install MDNS Components
#  apt:
#    pkg:        avahi-daemon,libnss-mdns
#    state:      latest
#  when: "'{{ansible_os_family}}' == 'Debian' and '{{hostname_avahi}}'"

  ### END DBK
