# Name:    roles/function_octoprint/tasks/setup_autologin.yaml
# Author:  D. Brian Kimmel
# Updated: 2020-12-21
#
# This task will autologin the octo user on computer start up.
#
# 
#
---

- name: Task-01(AutoLogin) - Autologin as octo user.
  lineinfile:
    path:               '/etc/systemd/system/autologin@.service'
    regexp:             'ExecStart=-/sbin/agetty --autologin '
    line:               'ExecStart=-/sbin/agetty --autologin {{ octoprint_user_name }} --noclear %I $TERM'

- name: Task-02(AutoLogin) - append to .bashrc.
  blockinfile:
    path:               '/home/{{ octoprint_user_name }}/.bashrc'
    block: |
      ### AutoLogin octo ###
      #
      # Start pyhoctoprintouse if we autologin this user
      #
      if [ $(tty) == /dev/tty1 ]; then
          bin/start_octoprint
      fi
      ### END DBK

#
### END DBK
