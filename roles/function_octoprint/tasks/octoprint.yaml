# Name:    PyHouse-ansible/roles/install-octoprint/tasks/main.yaml
# Author:  D. Brian Kimmel
# Created: 2018-06-27
# Updated: 2018-07-03

---


#virtualenv venv
#source venv/bin/activate
#pip install pip --upgrade
#pip install https://get.octoprint.org/latest

- name: MainTask-07 - set fact
  set_fact:
    virtualenv_dir:     "{{ pyh_octoprint_src_path }}/.env"
    listen_port:        "{{ pyh_octo_listen_port }}"

- name: MainTask-08 - Download OctoPrint source
  git:
    repo:               https://github.com/foosel/OctoPrint.git
    dest:               "{{ pyh_octoprint_src_path }}/clone"
  become:               yes
  become_user:          "{{ pyh_octo_user_name }}"

- name: MainTask-12 - Install OctoPrint systemd Unit
  template:
    src:                octoprint.service.j2
    dest:               "/etc/systemd/system/octoprint.service"
  become:               yes
  become_method:        sudo

- name: MainTask-13 - reload systemd
  command:              systemctl daemon-reload
  become:               yes
  become_method:        sudo

- name: MainTask-14 - Enable and start OctoPrint service
  service:
    name:               octoprint
    enabled:            yes
    state:              restarted
  become:               yes
  become_method:        sudo

### END DBK
