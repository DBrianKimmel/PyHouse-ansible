# Name:    PyHouse-ansible/main.yaml - the master playbook
# Author:  D. Brian Kimmel
# Created: 2017-09-18
# Updated: 2017-10-02
#
# This is the sitewide master fileThis is the starting point for the playbook.
#
# see the ssh configuration in     ~/.ssh/config

---

- hosts: all
  become: yes
  become_method: sudo
  gather_facts: yes

  pre_tasks:

    - name: Fail if Ansible is ancient
      fail: msg="We need Ansible >= 2.0. Please update your kit. 'pip install -U Ansible'"
      when: ansible_version.major < 2
      tags:
        - always

    - name: Include vars from local-configure.yml if found
      include_vars: "{{ item }}"
      with_first_found:
       - local-configure.yml
       - null.yml
      tags:
        - update_packages
        - restart_script
        - postfix
        - logwatch
        - motd
        - timezone
        - audit

# Do all the houses
- include: houses.yaml

# Do other things
#- include: xxx.yaml

### END DBK
